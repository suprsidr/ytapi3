!function(a,b,c,d){function e(b,c){this.element=a(b),this.options=a.extend({},g,c),this._defaults=g,this._name=f,this.thumbList=this.element.find(".thumbs-list"),this.iframe=this.element.find("iframe"),this.descContainer=this.element.find(".desc-container"),this.channelContainer=this.element.find(".channel-container"),this.currentChannel=this.channelContainer.find(".current-channel"),this.prevArrow=this.element.find(".prev-arrow"),this.nextArrow=this.element.find(".next-arrow"),this.controlBar=this.element.find(".control-bar"),this.searchBox=this.element.find(".search-box"),this.searchContainer=this.element.find(".search-container"),this.msg=this.element.find(".msg"),this.isTouch=!1,this.init()}var f="ytapi3",g={username:"",key:"",earl:"https://www.googleapis.com/youtube/v3",channelId:"",videoList:"",playlist:[],uploadsPlaylistId:"",currentPlaylistId:"",currentItems:[],currentPlaylistItems:[],currentQuery:"",maxResults:10,showChannelPlaylists:!0,urlParams:"?theme=light&autoplay=1&wmode=opaque&rel=0"};e.prototype={init:function(){var d=this;("ontouchstart"in b||b.DocumentTouch&&c instanceof DocumentTouch)&&(a("html").addClass("touch"),d.isTouch=!0),this.descContainer.append("<h4 /><p />"),this.options.videoList.length?this.getVideoItems(this.options.videoList):this.options.playlist.length&&a.each(this.options.playlist,function(){d.channelContainer.find(".sub-menu").append(a("<li />").append(a("<a />").attr("href",this.name).addClass(this.type).data(this.type,this.id).text(this.name).on("click",function(b){b.preventDefault();var c=a(this).data();c.channelid?(d.getId(c.channelid),d.searchBox.val(a(".lt-ie9").length>0?"Search this channel":""),d.currentChannel.html('<span class="channelid">'+a(this).text()+"</span>"),d.searchContainer.show()):c.playlistid&&(d.getPlaylistItems(c.playlistid),d.searchBox.val(a(".lt-ie9").length>0?"Search this channel":""),d.currentChannel.html('<span class="playlistid">'+a(this).text()+"</span>"),d.searchContainer.hide(),d.playlistSelector&&d.playlistSelector.find(".sub-menu").empty().end().hide())})))}),this.element.on("click",".more",function(b){b.preventDefault(),a(this).hide("slow").parent().removeClass("has-more")}).on("click",'a[href="#search"]',function(a){a.preventDefault(),d.getSearchItems(d.element.find(".search-box").val())}).on("keyup",".search-box",function(a){a.preventDefault(),13===a.keyCode&&d.element.find('a[href="#search"]').trigger("click")}),a(".lt-ie9").length>0&&(this.searchBox.get(0).value="Search this channel",this.searchBox.on("focus",function(){"Search this channel"===this.value&&(this.value="")}).on("blur",function(){""===this.value&&(this.value="Search this channel")})),this.options.playlist.length>0?this.channelContainer.find(".sub-menu a").first().trigger("click"):""!==this.options.username&&this.getId(this.options.username)},getId:function(b){var c=this,d={part:"id, contentDetails",forUsername:b,key:c.options.key,maxResults:this.options.maxResults};a.ajax({url:c.options.earl+"/channels",data:d,dataType:"jsonp"}).done(function(b){b.items&&b.items[0].id&&(c.options.channelId=b.items[0].id,c.options.uploadsPlaylistId=b.items[0].contentDetails.relatedPlaylists.uploads,c.getPlaylistItems(c.options.uploadsPlaylistId),c.options.showChannelPlaylists&&(0===c.element.find(".playlist-selector").length&&(c.playlistSelector=a("<div />").addClass("playlist-selector").append(a("<h5 />").addClass("current-playlist")).append(a("<ul />").addClass("sub-menu")),c.controlBar.find("> div:nth-of-type(2)").append(c.playlistSelector)),c.playlistSelector.show(),c.getPlaylists()))}).fail(function(a){console.log("error",a)})},getPlaylistItems:function(b,c){var e=this,f={part:"snippet,contentDetails",key:e.options.key,playlistId:b,maxResults:e.options.maxResults,order:"date",pageToken:c||""};e.options.currentPlaylistId=b,a.ajax({url:e.options.earl+"/playlistItems",data:f,dataType:"jsonp"}).done(function(b){b.items&&b.items.length>0?(a.each([e.prevArrow,e.nextArrow],function(){a(this).hide()}),e.options.currentItems=b.items,e.thumbList.empty(),a.each(b.items,function(b,c){e.thumbList.append(a("<li />").append(a("<a />").attr("href",c.contentDetails.note||c.snippet.title).data("index",b).append(a("<img />").attr("src",c.snippet.thumbnails.medium.url)).on("click",function(a){a.preventDefault(),c.snippet.description.length>300?e.descContainer.find("h4").text(c.contentDetails.note||c.snippet.title).end().find("p").addClass("has-more").html(e.filterText(c.snippet.description)+'<a href="more" class="more">Read More...</a>'):e.descContainer.find("h4").text(c.contentDetails.note||c.snippet.title).end().find("p").html(e.filterText(c.snippet.description)),e.iframe.attr("src","//www.youtube.com/embed/"+c.contentDetails.videoId+e.options.urlParams)})).append(a("<p />").text(c.contentDetails.note||c.snippet.title)))}),e.iframe.attr("src")===d&&e.thumbList.find("a").first().trigger("click"),b.prevPageToken&&e.prevArrow.show().off().on("click",function(a){a.preventDefault(),e.getPlaylistItems(e.options.currentPlaylistId,b.prevPageToken)}),b.nextPageToken&&e.nextArrow.show().off().on("click",function(a){a.preventDefault(),e.getPlaylistItems(e.options.currentPlaylistId,b.nextPageToken)})):e.displayMsg("Sorry, no items found for this query.")}).fail(function(a){console.log("error",a)})},getVideoItems:function(b){var c=this,e={id:b,part:"snippet",key:c.options.key};a.ajax({url:c.options.earl+"/videos",data:e,dataType:"jsonp"}).done(function(b){b.items&&b.items.length>0?(a.each([c.prevArrow,c.nextArrow],function(){a(this).hide()}),c.options.currentItems=b.items,c.thumbList.empty(),a.each(b.items,function(b,d){c.thumbList.append(a("<li />").append(a("<a />").attr("href",d.snippet.title).data("index",b).append(a("<img />").attr("src",d.snippet.thumbnails.medium.url)).on("click",function(a){a.preventDefault(),d.snippet.description.length>300?c.descContainer.find("h4").text(d.snippet.title).end().find("p").addClass("has-more").html(c.filterText(d.snippet.description)+'<a href="more" class="more">Read More...</a>'):c.descContainer.find("h4").text(d.snippet.title).end().find("p").html(c.filterText(d.snippet.description)),c.iframe.attr("src","//www.youtube.com/embed/"+d.id+c.options.urlParams)})).append(a("<p />").text(d.snippet.title)))}),c.iframe.attr("src")===d&&c.thumbList.find("a").first().trigger("click"),b.prevPageToken&&c.prevArrow.show().off().on("click",function(a){a.preventDefault(),c.getPlaylistItems(c.options.currentPlaylistId,b.prevPageToken)}),b.nextPageToken&&c.nextArrow.show().off().on("click",function(a){a.preventDefault(),c.getPlaylistItems(c.options.currentPlaylistId,b.nextPageToken)})):c.displayMsg("Sorry, no items found for this query.")}).fail(function(a){console.log("error",a)})},getSearchItems:function(b,c){var e=this,f={part:"snippet",key:e.options.key,q:b,channelId:e.options.channelId,maxResults:e.options.maxResults,order:"date",pageToken:c||null};e.options.currentQuery=b,a.ajax({url:e.options.earl+"/search",data:f,dataType:"jsonp"}).done(function(b){b.items&&b.items.length>0?(a.each([e.prevArrow,e.nextArrow],function(){a(this).hide()}),e.options.currentItems=b.items,e.thumbList.empty(),a.each(b.items,function(b,c){e.thumbList.append(a("<li />").append(a("<a />").attr("href",c.snippet.title).data("index",b).append(a("<img />").attr("src",c.snippet.thumbnails.medium.url)).on("click",function(a){a.preventDefault(),c.snippet.description.length>300?e.descContainer.find("h4").text(c.snippet.title).end().find("p").addClass("has-more").html(e.filterText(c.snippet.description)+'<a href="more" class="more">Read More...</a>'):e.descContainer.find("h4").text(c.snippet.title).end().find("p").html(e.filterText(c.snippet.description)),e.iframe.attr("src","//www.youtube.com/embed/"+c.id.videoId+e.options.urlParams)})).append(a("<p />").text(c.snippet.title)))}),e.iframe.attr("src")===d&&e.thumbList.find("a").first().trigger("click"),b.prevPageToken&&e.prevArrow.show().off().on("click",function(a){a.preventDefault(),e.getSearchItems(e.options.currentQuery,b.prevPageToken)}),b.nextPageToken&&e.nextArrow.show().off().on("click",function(a){a.preventDefault(),e.getSearchItems(e.options.currentQuery,b.nextPageToken)})):e.displayMsg("Sorry, no items found for this query.")}).fail(function(a){console.log("error",a)})},getPlaylists:function(){var b=this,c={part:"snippet,contentDetails",key:b.options.key,channelId:b.options.channelId,maxResults:50};this.element.find(".rt-arrow, .lt-arrow").hide(),a.ajax({url:b.options.earl+"/playlists",data:c,dataType:"jsonp"}).done(function(c){c.items.length>0&&(b.options.currentPlaylistItems=c.items,b.controlBar.find(".playlist-selector .sub-menu").empty(),c.items.unshift({id:b.options.uploadsPlaylistId,snippet:{title:"Uploads"}}),a.each(c.items,function(c,d){0===c&&b.playlistSelector.find(".current-playlist").html('<span class="playlistid">'+d.snippet.title+"</span>"),b.controlBar.find(".playlist-selector .sub-menu").append(a("<li />").append(a("<a />").attr("href",d.snippet.title).addClass("playlistid").data("playlistid",d.id).text(d.snippet.title).on("click",function(c){c.preventDefault();var d=a(this).data();b.getPlaylistItems(d.playlistid),b.searchBox.val(""),b.playlistSelector.find(".current-playlist").html('<span class="playlistid">'+a(this).text()+"</span>"),b.searchContainer.hide(),a(this).blur().closest(".playlist-selector").blur()})))}))}).fail(function(a){console.log("error",a)})},filterText:function(a){return a.replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi,'<a href="$1" target="_blank">$1</a>')},displayMsg:function(a){var b=this;b.msg.text(a).slideToggle("fast"),setTimeout(function(){b.msg.slideToggle("fast")},3e3)}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);